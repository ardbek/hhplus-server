[//]: # (요구사항 명세)

# 요구사항 명세

- 각 기능 및 제약사항에 대해 단위 테스트를 반드시 하나 이상 작성.
- 다수의 인스턴스로 어플리케이션이 동작하더라도 기능에 문제가 없도록 작성.
- 동시성 이슈를 고려하여 구현.
- 대기열 개념을 고려해 구현.


## 1. 유저 대기열 토큰 발급

- 기능 설명
    - 사용자의 **UUID** 기반으로 대기열에 등록하고 토큰을 발급
    - 토큰에는 대기 순번을 포함.
- 제약 조건
    - 이미 대기열에 있는 유저는 새로 토큰을 발급할 수 없음.(중복 요청 방지)
    - 이후 모든 API 는 위 토큰을 이용해 대기열 검증을 통과해야 이용 가능.
- 예외 처리
    - UUID가 누락된 요청 → `400 Bad Request`
    - 이미 대기열에 있는 유저가 다시 요청 → `409 Conflict`
    - 인증 실패 → `401 Unauthorized`
---

## 2. 예약 가능 날짜 / 좌석 조회

- 기능 설명
    - 예약 가능한 날짜 목록을 조회 할 수 있음.
    - 특정 날짜에 대한 좌석 (1~50번) 예약 가능 여부를 조회함.
- 제약 조건
    - 하루당 좌석 수는 고정(1~50)
    - 과거 날짜는 조회할 수 없음.
- 예외 처리
    - 과거 날짜 조회 시 → `400 Bad Request`
    - 잘못된 날짜 형식 → `400 Bad Request`
    - 인증되지 않은 사용자 → `401 Unauthorized`

---



## 3. 좌석 예약 요청

- 기능 설명
    - 날짜와 좌석 번호를 입력받아 해당 좌석을 임시 배정
    - 좌석 예약과 동시에 해당 좌석은 그 유저에게 5분간 임시 배정(다른 사용자는 예약할 수 없는 상태.)
    - 만약 배정 시간 내에 결제가 완료되지 않는다면 좌석에 대한 임시 배정은 해제되어야 하며 다른 사용자는 예약할 수 없음.
- 제약 조건
    - 임시 배정된 좌석은 다른 사용자가 예약 불가
    - 임시 배정 시 TTL 설정 (5분 경과 시 자동 해제)
- 예외 처리 
  - 좌석 번호 범위(1~50)를 벗어나는 경우 → `400 Bad Request` 
  - 이미 예약되었거나 임시 배정 중인 좌석 → `409 Conflict` 
  - 대기열 통과되지 않은 사용자 → `403 Forbidden`
  
---

## 4. 잔액 충전 / 조회

- 기능 설명
  - 사용자로부터 충전할 금액을 입력받아 잔액을 증가시킴.
  - 현재 잔액을 실시간으로 조회할 수 있음.
  
- 제약 조건
  - 1회 충전 금액은 1원 이상, 2,000,000원 이하.
  - 월 최대 충전 금액은 10,000,000원을 초과할 수 없음.

- 예외 처리
  - 충전 금액이 0 이하 → `400 Bad Request`
  - 충전으로 인해 월 한도를 초과할 경우 → `409 Conflict`
  - 인증되지 않은 사용자 → `401 Unauthorized`

---

## 5. 결제

- 기능 설명
  - 임시 배정된 좌석을 결제로 확정
  - 사용자의 잔액에서 금액 차감, 좌석을 예약 완료 상태로 변경
  - 결제 완료 시 대기열 만료 처리
- 제약 조건
  - 잔액 부족 시 결제 불가
  - 임시 배정이 만료된 상태에서는 결제 불가
- 예외 처리
  - 잔액 부족 → `402 Payment Required` 
  - 임시 배정 만료 → `410 Gone` 
  - 좌석 정보가 누락되거나 잘못된 경우 → `400 Bad Request` 
  - 인증 실패 또는 유효하지 않은 토큰 → `401 Unauthorized`